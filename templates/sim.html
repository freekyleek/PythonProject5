{% extends 'base.html' %}
{% block title %}SIM{% endblock %}
{% block content %}
<h1>SIM</h1>
<div class="toolbar">
  <a class="btn" href="{{ url_for('dodaj_sim') }}">Dodaj</a>
  <a class="btn" href="{{ url_for('zaduzi_sim') }}" style="margin-left:8px; background:#198754;">Zaduži</a>
</div>

{% if sims %}
<table class="tbl">
  <thead><tr><th>Provider</th><th>Serijski broj</th><th>Dodano</th><th></th></tr></thead>
  <tbody>
    {% for s in sims %}
    <tr>
      <td>{{ s.provider }}</td>
      <td>{{ s.serijski }}</td>
      <td>{{ s.created_at[:19] if s.created_at }}</td>
      <td>
        {% if current_user.is_superadmin %}
          <button class="delete-x" title="Obriši SIM" data-serial="{{ s.serijski }}">×</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>Nema SIM kartica.</p>
{% endif %}

<style>
.toolbar{ margin: 8px 0 16px; }
.btn{ display:inline-block; padding:8px 14px; border-radius:8px; background:#0b5ed7; color:#fff; text-decoration:none; }
.tbl{ width:100%; border-collapse:collapse; }
.tbl th, .tbl td{ border-bottom:1px solid rgba(255,255,255,.15); padding:8px; text-align:left; }
.delete-x{ background: transparent; border: 1px solid rgba(255,255,255,.4); color: #fff; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 18px; line-height: 1; }
.delete-x:hover{ background: rgba(220,53,69,.9); border-color: rgba(220,53,69,1); }
</style>
<script>
document.addEventListener('click', async (e)=>{
  const btn = e.target.closest('.delete-x');
  if(!btn) return;
  const serial = btn.getAttribute('data-serial');
  if(!confirm(`Obrisati SIM ${serial}?`)) return;
  const res = await fetch(`/api/sim/${encodeURIComponent(serial)}/delete`, {method:'POST'});
  const data = await res.json().catch(()=>({}));
  if(data.ok){ location.reload(); }
  else{ alert(data.error || 'Greška pri brisanju.'); }
});
</script>
{% endblock %}
